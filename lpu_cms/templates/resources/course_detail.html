{% extends 'base.html' %}
{% block title %}{{ course.code }} — {{ course.name }}{% endblock %}
{% block page_title %}Course Detail{% endblock %}

{% block extra_css %}
<style>
  .course-header {
    background: linear-gradient(135deg, var(--ink), #1c1a14);
    border-radius: 14px; padding: 24px 28px;
    display: flex; align-items: flex-start; gap: 20px;
    margin-bottom: 24px;
  }
  .course-code-badge {
    background: var(--gold); color: var(--ink);
    border-radius: 10px; padding: 8px 14px;
    font-family: 'DM Mono', monospace; font-size: 14px;
    font-weight: 700; flex-shrink: 0;
  }
  .course-header h1 { font-family:'Playfair Display',serif; color:var(--gold); font-size:20px; margin:0 0 6px; }
  .course-header p  { color:rgba(255,255,255,0.5); font-size:12.5px; margin:0 0 4px; }

  .info-grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 12px; margin-bottom: 24px;
  }
  .info-item {
    background: white; border: 1px solid var(--rule);
    border-radius: 10px; padding: 14px 16px;
  }
  .info-label { font-size:10.5px; text-transform:uppercase; letter-spacing:0.08em; color:var(--slate); margin-bottom:4px; }
  .info-value { font-family:'Playfair Display',serif; font-size:18px; font-weight:700; color:var(--ink); }
  .info-sub   { font-size:11.5px; color:var(--slate); margin-top:2px; }

  .enr-bar-row { display:flex; align-items:center; gap:12px; margin-bottom:20px; }
  .enr-bar-bg  { flex:1; height:10px; background:var(--parchment); border-radius:5px; overflow:hidden; }
  .enr-bar-fill { height:100%; border-radius:5px; background:var(--gold); transition:width 1s ease; }

  .student-row {
    display: flex; align-items: center; gap: 12px;
    padding: 11px 18px; border-bottom: 1px solid var(--rule);
    font-size: 13px; transition: background 0.15s;
  }
  .student-row:last-child { border-bottom: none; }
  .student-row:hover { background: rgba(247,244,238,0.8); }
  .stu-avatar {
    width: 30px; height: 30px; border-radius: 50%;
    background: linear-gradient(135deg, var(--gold), var(--rust));
    display: flex; align-items: center; justify-content: center;
    font-size: 11px; font-weight: 600; color: white;
    flex-shrink: 0; text-transform: uppercase;
  }
  .stu-name { flex: 1; font-weight: 500; }
  .stu-reg  { font-family:'DM Mono',monospace; font-size:11.5px; color:var(--slate); min-width:110px; }
  .stu-dept { font-size:12px; color:var(--slate); min-width:120px; }
  .grade-pill {
    font-size:11px; font-weight:700; padding:3px 10px;
    border-radius:20px; background:var(--parchment); color:var(--slate);
  }
  .grade-pill.graded { background:var(--ink); color:var(--gold); }
</style>
{% endblock %}

{% block content %}

<div style="display:flex;align-items:center;gap:12px;margin-bottom:20px;">
  <a href="{% url 'resources:course_list' %}" class="btn-outline" style="font-size:12px;padding:6px 12px;">
    <i class="bi bi-arrow-left"></i> All Courses
  </a>
</div>

<!-- Header -->
<div class="course-header">
  <div class="course-code-badge">{{ course.code }}</div>
  <div style="flex:1;">
    <h1>{{ course.name }}</h1>
    <p><i class="bi bi-person"></i> {{ course.faculty.user.get_full_name|default:"Faculty TBA" }}</p>
    {% if course.classroom %}
    <p><i class="bi bi-door-open"></i> {{ course.classroom.block.code }}-{{ course.classroom.room_number }} ({{ course.classroom.get_room_type_display }})</p>
    {% endif %}
  </div>
  <div style="text-align:center;background:rgba(255,255,255,0.06);border-radius:10px;padding:12px 20px;flex-shrink:0;">
    <div style="font-family:'Playfair Display',serif;font-size:26px;color:var(--gold);font-weight:700;">
      {{ course.enrollment_percent }}%
    </div>
    <div style="font-size:10.5px;color:rgba(255,255,255,0.4);text-transform:uppercase;letter-spacing:0.08em;">
      Enrollment
    </div>
  </div>
</div>

<!-- Info cards -->
<div class="info-grid">
  <div class="info-item">
    <div class="info-label">Students Enrolled</div>
    <div class="info-value">{{ course.enrolled_count }}</div>
    <div class="info-sub">of {{ course.max_students }} max</div>
  </div>
  <div class="info-item">
    <div class="info-label">Credits</div>
    <div class="info-value">{{ course.credits }}</div>
    <div class="info-sub">credit hours</div>
  </div>
  <div class="info-item">
    <div class="info-label">Contact Hours</div>
    <div class="info-value">{{ course.hours_per_week }}</div>
    <div class="info-sub">per week</div>
  </div>
  <div class="info-item">
    <div class="info-label">Semester</div>
    <div class="info-value">{{ course.semester }}</div>
    <div class="info-sub">{{ course.department.name|default:"—" }}</div>
  </div>
</div>

<!-- Enrollment bar -->
<div style="margin-bottom:6px;font-size:12px;color:var(--slate);display:flex;justify-content:space-between;">
  <span>Enrollment Capacity</span>
  <span>{{ course.enrolled_count }} / {{ course.max_students }}</span>
</div>
<div class="enr-bar-row">
  <div class="enr-bar-bg">
    <div class="enr-bar-fill" style="width:{{ course.enrollment_percent }}%"></div>
  </div>
  <span style="font-weight:700;font-size:13px;min-width:40px;">{{ course.enrollment_percent }}%</span>
</div>

<!-- Enrolled students table -->
<div class="lpu-card">
  <div class="lpu-card-header">
    <span class="lpu-card-title">Enrolled Students</span>
    <span style="font-size:12px;color:var(--slate);">{{ enrollments|length }} student(s)</span>
  </div>
  <div>
    {% if enrollments %}
    {% for enr in enrollments %}
    <div class="student-row">
      <div class="stu-avatar">
        {{ enr.student.user.first_name|first }}{{ enr.student.user.last_name|first }}
      </div>
      <div class="stu-name">{{ enr.student.user.get_full_name }}</div>
      <div class="stu-reg">{{ enr.student.registration_no }}</div>
      <div class="stu-dept">{{ enr.student.department.name|default:"—" }}</div>
      <div style="font-size:12px;color:var(--slate);">
        Since {{ enr.enrolled_on|date:"M d, Y" }}
      </div>
      <span class="grade-pill {% if enr.grade != '-' %}graded{% endif %}">
        {{ enr.grade }}
      </span>
    </div>
    {% endfor %}
    {% else %}
    <div style="padding:30px;text-align:center;color:var(--slate);font-size:13px;">
      No students enrolled yet.
    </div>
    {% endif %}
  </div>
</div>

{% endblock %}