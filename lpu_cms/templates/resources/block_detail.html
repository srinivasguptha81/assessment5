{% extends 'base.html' %}
{% block title %}{{ block.name }} ‚Äî Block Detail{% endblock %}
{% block page_title %}{{ block.code }} ‚Äî {{ block.name }}{% endblock %}

{% block extra_css %}
<style>
  .block-header {
    background: linear-gradient(135deg, var(--ink), #1c1a14);
    border-radius: 14px;
    padding: 22px 28px;
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 24px;
  }
  .block-badge {
    width: 56px; height: 56px;
    background: var(--gold);
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-family: 'Playfair Display', serif;
    font-size: 20px; font-weight: 700;
    color: var(--ink); flex-shrink: 0;
  }
  .block-header h1 { font-family:'Playfair Display',serif; color:var(--gold); font-size:20px; margin:0 0 4px; }
  .block-header p  { color:rgba(255,255,255,0.5); font-size:12.5px; margin:0; }

  .rooms-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: 14px;
  }
  .room-card {
    background: white;
    border: 1px solid var(--rule);
    border-radius: 12px;
    padding: 16px 18px;
    text-decoration: none;
    color: inherit;
    display: block;
    transition: border-color 0.2s, box-shadow 0.2s, transform 0.2s;
  }
  .room-card:hover {
    border-color: var(--gold);
    box-shadow: 0 6px 20px rgba(0,0,0,0.07);
    transform: translateY(-2px);
    text-decoration: none; color: inherit;
  }
  .room-num {
    font-family: 'DM Mono', monospace;
    font-size: 13px; font-weight: 500;
    color: var(--gold); margin-bottom: 4px;
  }
  .room-type {
    font-size: 11px; color: var(--slate);
    text-transform: uppercase; letter-spacing: 0.08em;
    margin-bottom: 12px;
  }
  .room-amenities {
    display: flex; gap: 6px; flex-wrap: wrap;
    margin-bottom: 12px;
  }
  .amenity-tag {
    font-size: 10.5px;
    background: var(--parchment);
    border-radius: 4px;
    padding: 2px 7px;
    color: var(--slate);
  }
  .room-util-row {
    display: flex; align-items: center; gap: 10px;
    font-size: 12px;
  }
  .room-bar { flex: 1; height: 6px; background: var(--parchment); border-radius: 4px; overflow: hidden; }
  .room-bar-fill { height: 100%; border-radius: 4px; }
  .status-over { background: #dc2626; }
  .status-high { background: var(--rust); }
  .status-moderate { background: var(--gold); }
  .status-low { background: #16a34a; }
</style>
{% endblock %}

{% block content %}
<div style="display:flex;align-items:center;gap:12px;margin-bottom:20px;">
  <a href="{% url 'resources:dashboard' %}" class="btn-outline" style="font-size:12px;padding:6px 12px;">
    <i class="bi bi-arrow-left"></i> Overview
  </a>
</div>

<div class="block-header">
  <div class="block-badge">{{ block.code|slice:":2" }}</div>
  <div>
    <h1>{{ block.name }}</h1>
    <p>{{ block.total_classrooms }} classrooms &nbsp;¬∑&nbsp; {{ block.total_capacity }} total seats &nbsp;¬∑&nbsp; {{ block.total_floors }} floor(s)</p>
    {% if block.description %}<p style="margin-top:4px;">{{ block.description }}</p>{% endif %}
  </div>
  <div style="margin-left:auto;text-align:center;background:rgba(255,255,255,0.06);border-radius:10px;padding:14px 22px;">
    <div style="font-family:'Playfair Display',serif;font-size:28px;color:var(--gold);font-weight:700;">{{ block.utilization_percent }}%</div>
    <div style="font-size:11px;color:rgba(255,255,255,0.4);text-transform:uppercase;letter-spacing:0.08em;">Block Utilization</div>
  </div>
</div>

<div style="font-family:'Playfair Display',serif;font-size:16px;margin-bottom:14px;">Classrooms</div>

{% if classrooms %}
<div class="rooms-grid">
  {% for room in classrooms %}
  {% with u=room.utilization_percent %}
  <a href="{% url 'resources:classroom_detail' room.id %}" class="room-card">
    <div class="room-num">{{ block.code }}-{{ room.room_number }}</div>
    <div class="room-type">{{ room.get_room_type_display }}</div>
    <div class="room-amenities">
      {% if room.has_projector  %}<span class="amenity-tag">üìΩ Projector</span>{% endif %}
      {% if room.has_ac         %}<span class="amenity-tag">‚ùÑ AC</span>{% endif %}
      {% if room.has_smartboard %}<span class="amenity-tag">üìã Smartboard</span>{% endif %}
    </div>
    <div class="room-util-row">
      <span style="color:var(--slate);min-width:70px;">{{ room.current_enrollment }}/{{ room.capacity }}</span>
      <div class="room-bar">
        <div class="room-bar-fill status-{{ room.utilization_status }}" style="width:{{ u }}%"></div>
      </div>
      <span style="font-weight:600;font-size:12px;min-width:36px;text-align:right;">{{ u }}%</span>
    </div>
  </a>
  {% endwith %}
  {% endfor %}
</div>
{% else %}
<div style="text-align:center;padding:50px;color:var(--slate);background:white;border-radius:12px;border:1px solid var(--rule);">
  <div style="font-size:40px;margin-bottom:10px;">üè´</div>
  <div>No classrooms found for this block.</div>
</div>
{% endif %}
{% endblock %}